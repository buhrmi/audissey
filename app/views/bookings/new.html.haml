= form_for @booking do |f|
  = f.hidden_field :offering_id
  .section.new_booking
    .container
      %h1 New Contract with #{@offering.actionable_name}
      %p Make a request with flexible pricing
      .row
        .col-sm-6
          .form-group
            %label City or Venue
            %input.form-control(v-model="location" name="location")
        .col-sm-6
          .form-group
            %label Date of event
            %input.datepicker.form-control(name="booking[start_at]" v-model="date")
      .row
        .col-sm-6
          .form-group
            %label Budget

            .input-group
              %input(type="hidden" name="booking[price_attributes][currency]" v-model="currency")
              .input-group-addon {{symbol}}
              %input.form-control(v-model = "amount" name="booking[price_attributes][take]")
              .input-group-addon {{currency}}
              .input-group-btn
                .btn.btn-default.dropdown-toggle(data-toggle="dropdown")
                  .caret
                %ul.dropdown-menu.dropdown-menu-right
                  - Price::CURRENCIES.keys.each do |currency|
                    %li
                      %a{:href => '#', 'v-on:click.prevent' => "$set('currency', '#{currency}')"}= currency
        .col-sm-6
          - if @offering.category_id == 'performer'
            %p Note: You are responsible for covering transportation and lodging for the performer.
      .actions
        = f.submit "Send Request", :class => 'btn btn-primary btn-lg', ':disabled' => '!allGood()'

:coffee
  currencies = #{Price::CURRENCIES.to_json}
  new Vue
    el: '.new_booking'
    data:
      location: '#{params[:location]}' || 'Tokyo'
      amount: '#{params[:amount]}' || 50000
      currency: '#{params[:currency]}' || 'JPY'
      date: '#{4.weeks.from_now.strftime("%Y-%m-%d")}'
    methods:
      allGood: ->
        this.$get('location') && this.$get('amount') && this.$get('currency') && this.$get('date')
    ready: ->
      this.$set('symbol', currencies[this.$get('currency')].symbol)
      this.$watch 'currency', (val) ->
        this.$set('symbol', currencies[val].symbol)
